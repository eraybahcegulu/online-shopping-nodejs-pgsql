<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <title>Product Form</title>
</head>
<body>

<div class="container mt-5">
    <h2>Add Product</h2>
    <form action="/productAdd" method="post">
        <div class="form-group">
            <label for="productType">Product Type:</label>
            <select class="form-control" id="productType" name="productType" required>
                <option disabled selected value="">Select Product Type
                </option>
                <% productTypes.forEach(productType => { %>
                  <option >
                    <%=productType.type%>
                  </option>
                <% }); %>
              </select>

            
        </div>
        <div class="form-group">
            <label for="productName">Product Name:</label>
            <input type="text" class="form-control" id="productName" name="productName" required>
        </div>
        <div class="form-group">
            <label for="productPrice">Product Price:</label>
            <input type="number" step="0.01" class="form-control" id="productPrice" name="productPrice" required>
        </div>
        <div class="form-group">
            <label for="productDescription">Product Description:</label>
            <textarea class="form-control" id="productDescription" name="productDescription" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Add Product</button>
    </form>

    <div id="productAddMessage" class="mt-3">
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    var productAddMessage = document.getElementById("productAddMessage");

    document.querySelector('form').addEventListener('submit', function (event) {
        event.preventDefault(); // Formdaki submiti engelliyoruz ve fetch api gerçekleştiriyoruz

        fetch('/productAdd', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                type: document.getElementById('productType').value,
                name: document.getElementById('productName').value,
                price: document.getElementById('productPrice').value,
                description: document.getElementById('productDescription').value,
            }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.newProduct) {
                productAddMessage.innerHTML = '<p>Kayıt başarılı</p>';
            } else {
                productAddMessage.innerHTML = '<p>Kayıt başarısız</p>';
            }
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    });
</script>


</body>
</html>